\begin{LVerbatim}[commandchars=\\\{\},numbers=left,firstnumber=1,stepnumber=1,xleftmargin=7mm, fontsize=\small, boxwidth=3cm]
\PY{k}{module} \PY{n+nn}{Combinator}
  \PY{k}{def} \PY{n+nf}{construct\PYZus{}covers} \PY{n}{n}\PY{p}{,} \PY{n}{e}
    \PY{n}{s} \PY{o}{=} \PY{n}{get\PYZus{}subsets} \PY{n}{n}\PY{o}{.}\PY{n}{collect}\PY{p}{\PYZob{}}\PY{o}{|}\PY{n}{k}\PY{o}{|} \PY{n}{k}\PY{o}{.}\PY{n}{id}\PY{p}{\PYZcb{}}
    \PY{n}{s} \PY{o}{=} \PY{n}{test\PYZus{}covers}\PY{p}{(}\PY{n}{s}\PY{p}{,}\PY{n}{e}\PY{p}{)}
    \PY{k}{return} \PY{n}{covers\PYZus{}to\PYZus{}set} \PY{n}{s}
  \PY{k}{end}

  \PY{k}{def} \PY{n+nf}{get\PYZus{}subsets} \PY{n}{n}
    \PY{n}{subsets} \PY{o}{=} \PY{o}{[}\PY{o}{]}
    \PY{n}{x} \PY{o}{=} \PY{n}{n}\PY{o}{.}\PY{n}{length} \PY{o}{-} \PY{l+m+mi}{1}
    \PY{p}{(}\PY{l+m+mi}{1}\PY{o}{.}\PY{n}{.}\PY{n}{x}\PY{p}{)}\PY{o}{.}\PY{n}{each} \PY{k}{do} \PY{o}{|}\PY{n}{k}\PY{o}{|}
      \PY{n}{subsets} \PY{o}{=} \PY{n}{subsets}\PY{o}{+}\PY{p}{(}\PY{n}{n}\PY{o}{.}\PY{n}{combination}\PY{p}{(}\PY{n}{k}\PY{p}{)}\PY{o}{.}\PY{n}{to\PYZus{}a}\PY{p}{)}
    \PY{k}{end}
    \PY{k}{return} \PY{n}{subsets}
  \PY{k}{end}

  \PY{k}{def} \PY{n+nf}{test\PYZus{}covers}\PY{p}{(}\PY{n}{s}\PY{p}{,} \PY{n}{e}\PY{p}{)}
    \PY{n}{e\PYZus{}array} \PY{o}{=} \PY{o}{[}\PY{o}{]}
    \PY{n}{e}\PY{o}{.}\PY{n}{each}\PY{p}{\PYZob{}}\PY{o}{|}\PY{n}{k}\PY{o}{|} \PY{n}{e\PYZus{}array}\PY{o}{.}\PY{n}{push}\PY{p}{(}\PY{n}{k}\PY{o}{.}\PY{n}{to\PYZus{}a}\PY{p}{)}\PY{p}{\PYZcb{}}
    \PY{n}{c} \PY{o}{=} \PY{o}{[}\PY{o}{]}
    \PY{n}{s}\PY{o}{.}\PY{n}{each}\PY{p}{\PYZob{}}\PY{o}{|}\PY{n}{k}\PY{o}{|} \PY{n}{c}\PY{o}{.}\PY{n}{push}\PY{p}{(}\PY{n}{k}\PY{p}{)} \PY{k}{if} \PY{n}{test\PYZus{}cover?}\PY{p}{(}\PY{n}{k}\PY{p}{,}\PY{n}{e\PYZus{}array}\PY{p}{)}\PY{p}{\PYZcb{}}
    \PY{k}{return} \PY{n}{c}
  \PY{k}{end}

  \PY{k}{def} \PY{n+nf}{test\PYZus{}cover?} \PY{n}{c}\PY{p}{,} \PY{n}{e}
    \PY{n}{e}\PY{o}{.}\PY{n}{each}\PY{p}{\PYZob{}}\PY{o}{|}\PY{n}{k}\PY{o}{|} \PY{k}{return} \PY{k+kp}{false} \PY{k}{if} \PY{p}{(}\PY{n}{c}\PY{o}{&}\PY{n}{k}\PY{p}{)}\PY{o}{.}\PY{n}{empty?}\PY{p}{\PYZcb{}}
    \PY{k}{return} \PY{k+kp}{true}
  \PY{k}{end}    

  \PY{k}{def} \PY{n+nf}{covers\PYZus{}to\PYZus{}set} \PY{n}{covers}
    \PY{n}{l} \PY{o}{=} \PY{n+no}{Set}\PY{o}{[}\PY{o}{]}
    \PY{n}{covers}\PY{o}{.}\PY{n}{each}\PY{p}{\PYZob{}}\PY{o}{|}\PY{n}{k}\PY{o}{|} \PY{n}{l}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n+no}{Set}\PY{o}{.}\PY{n}{new}\PY{p}{(}\PY{n}{k}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
    \PY{k}{return} \PY{n}{l}
  \PY{k}{end}
\PY{k}{end}
\end{LVerbatim}
